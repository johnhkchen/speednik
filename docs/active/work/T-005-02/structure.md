# Structure: T-005-02 hillside-loop-collision-fix

## Files Modified

### 1. `stages/hillside_rush.svg`

**Section 5 (lines 219–272) — the only section touched.**

#### Circle element (line 233)
- Before: `<circle cx="3600" cy="380" r="128" stroke="#00AA00" fill="none"/>`
- After:  `<circle cx="3600" cy="508" r="128" stroke="#00AA00" fill="none"/>`

#### Section comments (lines 222–223)
- Update to reflect new center: cy=508, bottom at y=636, top at y=380

#### Approach polygon (lines 226–230)
- Before: slopes from (3200,636) through intermediate points down to (3472,508)
- After: flat rectangle at y=636 from x=3200 to x=3472
- New shape: `3200,636 3472,636 3472,720 3200,720`
- Update comment to "Approach ground: flat at y=636"

#### Exit polygon (lines 235–239)
- Before: slopes from (3728,508) through intermediate points up to (4000,636)
- After: flat rectangle at y=636 from x=3728 to x=4000
- New shape: `3728,636 4000,636 4000,720 3728,720`
- Update comment to "Exit ground: flat at y=636"

#### Ground-beneath-loop polygon (lines 241–244)
- Delete entirely (4 lines including comment)

#### Loop rings: ring_131 through ring_150 (lines 247–266)
- Each ring: cy += 128 (shift from old center y=380 to new center y=508)
- ring_131: cy 400→528, ring_132: cy 376→504, ring_133: cy 356→484,
  ring_134: cy 340→468, ring_135: cy 328→456, ring_136: cy 324→452,
  ring_137: cy 328→456, ring_138: cy 340→468, ring_139: cy 356→484,
  ring_140: cy 376→504, ring_141: cy 400→528, ring_142: cy 424→552,
  ring_143: cy 444→572, ring_144: cy 460→588, ring_145: cy 472→600,
  ring_146: cy 476→604, ring_147: cy 472→600, ring_148: cy 460→588,
  ring_149: cy 444→572, ring_150: cy 424→552

#### Approach rings: ring_151 through ring_155 (lines 268–272)
- Flatten to ground-level height. All cy → 622 (consistent, slightly above ground).
- ring_151: cy 622→622 (no change), ring_152: cy 608→622,
  ring_153: cy 592→622, ring_154: cy 572→622, ring_155: cy 540→622

### 2. `speednik/stages/hillside/` (generated — 5 files)

All regenerated by running `svg2stage.py`. No manual edits.

- `collision.json` — loop collision ring shifts down 8 tile rows
- `tile_map.json` — loop tiles shift down, approach/exit become flat ground
- `entities.json` — ring coordinates update to match SVG changes
- `meta.json` — no change expected (stage dimensions unchanged)
- `validation_report.txt` — expected improvement (fewer angle warnings, no 12px gaps)

### 3. `tests/test_hillside.py`

#### TestLoopGeometry class (lines 106–128)

**test_loop_tiles_exist** (lines 107–117):
- Docstring: update center from (3600, 380) to (3600, 508)
- ty range: 15–32 → 23–40 (loop now spans y=368–640)
- tx range: 218–233 → unchanged

**test_loop_has_varied_angles** (lines 119–128):
- ty range: 15–32 → 23–40
- tx range: 218–233 → unchanged

## Files NOT Modified

- `tools/svg2stage.py` — pipeline tool, no changes needed
- `speednik/terrain.py` — terrain types unchanged
- `speednik/stages/hillside/__init__.py` — loader unchanged
- Any other stage files or game engine code

## Module Boundaries

No new modules, interfaces, or abstractions are introduced. The change is entirely
data-level: SVG source geometry → generated stage data → test range constants.

## Ordering

1. SVG edits (circle, polygons, rings) — all in one file, no ordering dependency
2. Delete ground-beneath-loop polygon
3. Regenerate stage data (depends on SVG edits being complete)
4. Update test ranges (can happen before or after regeneration, but verifying
   tests requires regenerated data)
