# Structure — T-006-01: fix-loop-arc-rasterization

## Files Modified

### 1. `tools/svg2stage.py`

Two single-line changes:

**`_rasterize_line_segment` (line 727):**
```
Before: height = max(0, min(16, round(tile_bottom_y - sy)))
After:  height = max(0, min(16, math.ceil(tile_bottom_y - sy)))
```

**`_rasterize_loop` (line 779):**
```
Before: height = max(0, min(16, round(tile_bottom_y - sy)))
After:  height = max(0, min(16, math.ceil(tile_bottom_y - sy)))
```

No new imports needed — `math` is already imported on line 16.
No functions added, removed, or renamed.
No public interface changes.

### 2. `tests/test_svg2stage.py`

Existing tests that assert exact height values computed via `round()` may need their
expected values updated to match `math.ceil()` behavior. Specifically:

- Tests in `TestRasterizer` that create terrain shapes, rasterize them, and check
  `height_array` values.
- The change from `round` to `ceil` shifts heights upward by 1 in cases where the
  fractional part of `(tile_bottom_y - sy)` is in (0, 0.5].

Strategy: Run tests first, identify failures, update expected values only where the
new `ceil`-based values are correct.

### 3. `speednik/stages/hillside/` (regenerated)

All output files regenerated by running:
```
uv run python tools/svg2stage.py stages/hillside_rush.svg speednik/stages/hillside/
```

Changed files:
- `tile_map.json` — height arrays updated where `ceil != round`
- `collision.json` — unchanged (solidity flags don't depend on height values)
- `entities.json` — unchanged (entities are independent of rasterization)
- `meta.json` — unchanged (dimensions and player start unaffected)
- `validation_report.txt` — loop-column gaps eliminated

## Files NOT Modified

- `speednik/terrain.py` — runtime terrain/physics unaffected
- `stages/hillside_rush.svg` — source SVG unchanged
- No new files created
- No files deleted

## Module Boundaries

The change is entirely within the rasterizer module of `svg2stage.py`. No cross-module
interfaces change. The validator reads from the same `TileGrid` structure, and the
writer serializes the same `TileData` format. Only the numeric values in `height_array`
differ.

## Ordering

1. Patch `tools/svg2stage.py` (both call sites)
2. Run tests, fix expected values if needed
3. Regenerate hillside stage data
4. Verify validation report
