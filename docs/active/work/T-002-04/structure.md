# Structure — T-002-04: Skybridge Gauntlet SVG Layout

## Files Created

### `stages/skybridge_gauntlet.svg`

SVG file, viewBox `0 0 5200 896`. Contains all terrain and entity elements for Stage 3.

**Organization:** Section-by-section with XML comments delineating each section, matching
the hillside_rush.svg convention.

**Terrain elements:**
- Section 1: Starting solid ground polygon + 4 top-only bridge polygons + 3 gap springs
- Section 2: Solid ramp polygon + top-only landing platform + top-only ascend platform
- Section 3: Solid ramp polygon + top-only landing platform + top-only ascend platform
- Section 4: Solid ramp polygon + top-only landing platform + top-only ascend platform
- Section 5: Top-only main bridge + solid low-detour platforms + guardian area
- Section 6: Solid arena floor polygon + wall polygons

**Entity elements:**
- 1 player_start circle (x=64, y=490)
- ~250 ring circles distributed per design
- 13+ enemy rects/circles across sections
- 7 spring_up rects under gaps
- 2 checkpoint circles
- 1 goal rect

### `speednik/stages/skybridge/` (generated by pipeline)

Directory created by running svg2stage.py. Contains:
- `tile_map.json` — 56 rows × 325 columns of tile data
- `collision.json` — 56 rows × 325 columns of solidity flags
- `entities.json` — flat array of all entities with type/x/y
- `meta.json` — dimensions, player_start, checkpoints
- `validation_report.txt` — pipeline validation output

### `speednik/stages/skybridge.py`

Loader module, ~70 lines. Follows hillside.py pattern exactly.

**Public interface:**
```python
class StageData:
    tile_lookup: TileLookup
    entities: list[dict]
    player_start: tuple[float, float]
    checkpoints: list[dict]
    level_width: int
    level_height: int

def load() -> StageData
```

**Internal:**
- `_DATA_DIR = Path(__file__).parent / "skybridge"`
- `_read_json(filename: str)` helper

**Imports:** json, dataclasses, pathlib, typing, speednik.terrain

### `tests/test_skybridge.py`

Test module, ~140 lines. Follows test_hillside.py pattern.

**Fixture:** `stage()` at module scope, calls `load()` once.

**Test classes:**

1. `TestLoadReturnsStageData`
   - test_returns_stage_data_instance
   - test_tile_lookup_is_callable
   - test_entities_is_list

2. `TestTileLookup`
   - test_bridge_tile_at_section1 — top-only tile at known bridge coordinate
   - test_solid_ground_at_arena — full solidity tile at arena floor
   - test_sky_returns_none — no tile in sky area
   - test_out_of_bounds_returns_none

3. `TestEntities`
   - test_player_start_exists — exactly 1
   - test_rings_approximately_250 — 240 ≤ count ≤ 260
   - test_enemy_crabs_present — count > 0
   - test_enemy_buzzers_present — count > 0
   - test_checkpoints_count — exactly 2
   - test_goal_present — exactly 1
   - test_springs_present — count > 0

4. `TestPlayerStart`
   - test_x_coordinate — 64.0
   - test_y_coordinate — 490.0

5. `TestLevelDimensions`
   - test_width — 5200
   - test_height — 896

6. `TestBridgeGeometry`
   - test_top_only_tiles_exist — verify TOP_ONLY tiles in bridge region
   - test_ramp_region_has_angled_tiles — tiles in ramp area have angle ≠ 0

## Files Not Modified

- `tools/svg2stage.py` — Pipeline is complete, no changes needed
- `speednik/stages/hillside.py` — No changes
- `speednik/terrain.py` — No changes
- `tests/test_hillside.py` — No changes

## Module Boundaries

```
stages/skybridge_gauntlet.svg
        │
        │  svg2stage.py (build step)
        ▼
speednik/stages/skybridge/
  ├── tile_map.json
  ├── collision.json
  ├── entities.json
  ├── meta.json
  └── validation_report.txt
        │
        │  skybridge.py (runtime)
        ▼
StageData {
  tile_lookup → speednik.terrain.Tile
  entities    → list[dict]
  meta fields → int, tuple, list
}
```

## SVG Section Layout (Coordinate Map)

```
Y=0   ┌─────────────────────────────────────────────────────────┐
      │                       (sky)                              │
Y=300 │                                                          │
      │     ┌─ascend─┐  ┌─ascend─┐  ┌─ascend─┐                 │
Y=400 │     └────────┘  └────────┘  └────────┘                 │
      │                                                          │
Y=500 │══╤══╤══╤══╤══╤══════════════════════════╤═══════════════│
      │  gaps  │  ramp→gap→land  ×3              │guard│  arena │
Y=600 │        │  ↗                              │     │        │
      │        │ /                               │  ┌──┤        │
Y=700 │        │/base                            │low│  │        │
      │                                          │det│  │        │
Y=800 │                                          └───┘  │        │
Y=896 └─────────────────────────────────────────────────────────┘
      0       800     1600    2400    3200    4000      5200
```

## Ordering of Changes

1. Create `stages/skybridge_gauntlet.svg` (all geometry and entities)
2. Create `speednik/stages/skybridge/` directory
3. Run pipeline: `uv run python tools/svg2stage.py stages/skybridge_gauntlet.svg speednik/stages/skybridge/`
4. Create `speednik/stages/skybridge.py` (loader)
5. Create `tests/test_skybridge.py` (tests)
6. Run tests, fix any issues
7. Review validation report, iterate on SVG if critical warnings
