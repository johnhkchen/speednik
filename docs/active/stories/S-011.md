---
id: S-011
title: automated-playability-and-regression-testing
type: story
status: open
priority: high
tickets: [T-011-01, T-011-02, T-011-03, T-011-04, T-011-05, T-011-06, T-011-07, T-011-08]
---

## Goal

Automated test coverage that catches the bugs a human playtester would find — soft-locks,
collision glitches, camera wobble, broken loops, unreachable goals — without requiring a
human to play the game dozens of times. Every stage × strategy combination is exercised
headlessly, with invariant checks that flag impossible physics states, geometry failures,
and camera instability.

## Background

S-010 built the headless simulation stack (`sim_step`, `create_sim`, `create_sim_from_lookup`).
S-008 built the test harness with strategy primitives (`hold_right`, `spindash_right`, etc.).
But there are no tests that answer the question: **can a naive player actually finish each
level without hitting a bug?**

The circular loop in hillside was visually rendered but not traversable. Springs might launch
into walls. Gaps might be unjumpable. Camera might oscillate wildly on slopes. These are the
kinds of bugs that only surface when someone plays the game — and they should surface in CI
instead.

This story builds the test suite that exercises real stages with robotic players and asserts
correctness at the physics, geometry, entity, and camera layers.

## Architecture

```
┌─────────────────────────────────────────────────────────┐
│  T-011-07  CI gate (GitHub Actions pytest)              │
├─────────────────────────────────────────────────────────┤
│  T-011-06  Naive-player regression suite (umbrella)     │
├──────────────┬──────────────┬───────────┬───────────────┤
│  T-011-03    │  T-011-02    │ T-011-04  │  T-011-05     │
│  Geometric   │  Invariant   │ Camera    │  Entity       │
│  probes      │  checker     │ stability │  interactions │
├──────────────┴──────────────┴───────────┴───────────────┤
│  T-011-01  Stage walkthrough smoke tests                │
├─────────────────────────────────────────────────────────┤
│  sim_step + create_sim (from S-010)                     │
└─────────────────────────────────────────────────────────┘
```

## DAG

Wide fan-out from T-010-02, then convergence into the regression suite and CI gate.

```
Gate: [T-010-02]

Wave 0 (5 concurrent):
T-011-01  (stage walkthrough smoke tests)      ┐
T-011-02  (physics invariant checker)           │
T-011-04  (camera in SimState + stability)      │ 5 concurrent
T-011-05  (entity interaction tests)            │
T-011-08  (extract shared code from tests/)     ┘

Wave 1:
T-011-01 ──→ T-011-03  (geometric feature probes)

Wave 2 (merge all):
T-011-01 + T-011-02 + T-011-03 + T-011-04 + T-011-05 + T-011-08
   └──→ T-011-06  (naive-player regression suite)

Wave 3:
T-011-06 ──→ T-011-07  (CI gate)
```

Critical path: 4 tickets deep (01 → 03 → 06 → 07).
