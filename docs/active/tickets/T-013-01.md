---
id: T-013-01
story: S-013
title: world-boundary-system
type: bug
status: open
priority: critical
phase: done
depends_on: []
---

## Context

The simulation has no enforcement of world boundaries. Players can move arbitrarily far in
any direction — negative X, beyond level_width, and below level_height — without being
clamped or killed. This causes thousands of invariant errors per audit run and means
bottomless pits don't kill the player.

Addresses: T-012-02-BUG-02, T-012-02-BUG-03, T-012-04-BUG-01 (pit death aspect).

## Root cause

`sim_step()` and `player_update()` have no position clamping logic. The boundary clamp
at line ~241 only partially handles X and does not handle Y. There is no death trigger
for `y > level_height`.

## Requirements

1. **Left boundary clamp**: Clamp player X to `>= 0`. If moving left and x < 0, set x = 0
   and zero horizontal velocity.

2. **Right boundary clamp**: Clamp player X to `<= level_width`. Same velocity zeroing.

3. **Pit death**: If player Y exceeds `level_height + margin` (e.g., 32px below the bottom
   tile row), kill the player via the existing `damage_player` / death mechanism. The player
   should respawn at the last checkpoint (or stage start).

4. **Apply to sim_step**: The boundary checks must run inside `sim_step()` so headless
   simulation, Gymnasium env, and live game all get the same behavior.

## Acceptance Criteria

- `position_x_beyond_right` invariant errors = 0 on Hillside jumper audit
- `position_x_negative` invariant errors = 0 on Hillside chaos audit
- `position_y_below_world` invariant errors = 0 on Skybridge walker audit
- Player dies and respawns when falling below level_height + 32
- Existing tests remain green (boundary behavior may change some trajectories)
