---
id: T-012-03-BUG-02
story: S-012
title: pipeworks-solid-tile-clipping
type: bug
status: open
priority: high
phase: done
---

## Summary

Walker and Wall Hugger clip into FULL solidity tiles at x≈3040-3095 in Pipeworks, generating
150 `inside_solid_tile` invariant errors. The player enters a bounce oscillation between solid
tiles and cannot escape, getting trapped at the boundary of a wall/ceiling tile region.

## Affected Archetypes

| Archetype    | inv_errors | Clipping zone          | Behavior                        |
|--------------|-----------|------------------------|--------------------------------|
| Walker       | 150       | x=3042-3094, y=652-734 | Clips into solid, bounces      |
| Wall Hugger  | 150       | x=3042-3094, y=652-734 | Identical trajectory to Walker |

Both archetypes produce identical results because Wall Hugger's jump-when-stalled behavior
doesn't trigger before the clipping zone, so both just hold right.

## Root Cause

The tile region around column 190, rows 40-47 contains:
- angle=64 (wall) tiles at (190,40) and (190,41)
- angle=128 (ceiling) tiles at (191-195,41)
- FULL solidity (solidity=2) on all tiles in the region

When the player falls into this area from above (frame 787, x=3036.5, y=722.0, landing from
a jump state), collision resolution places the player inside solid tiles. The alternating
ground/jump state each frame shows the physics oscillating:

```
f=787: x=3036.5, y=722.0, on_ground=True, angle=0   (lands)
f=788: x=3042.8, y=734.0, on_ground=False            (INSIDE SOLID - invariant error)
f=789: x=3049.1, y=706.0, on_ground=True, angle=0    (snapped to surface)
f=790: x=3055.5, y=718.0, on_ground=False             (INSIDE SOLID)
...
f=796: x=3094.9, y=646.0, angle=128, q=2             (hits ceiling tile)
f=797: x=3088.2, y=646.0, vx=-6.7                    (reverses direction)
f=798-end: oscillates in ceiling bounce loop at x≈3081-3094
```

The physics layer cannot find a valid non-solid position for the player in this region,
leading to persistent clipping and a trapped state.

## Tile Layout

```
tile(190,40): angle=64, sol=2, type=1  (wall)
tile(190,41): angle=64, sol=2, type=1  (wall)
tile(191,41): angle=128, sol=2, type=1 (ceiling)
tile(192,41): angle=128, sol=2, type=1 (ceiling)
tile(193,41): angle=128, sol=2, type=1 (ceiling)
tile(190-195, 42-47): angle=0, sol=2   (solid fill)
```

## Reproduction

```python
from speednik.qa import BehaviorExpectation, run_audit, make_walker
exp = BehaviorExpectation(
    name="pipeworks_walker", stage="pipeworks", archetype="walker",
    min_x_progress=3000, max_deaths=2, require_goal=False,
    max_frames=3600, invariant_errors_ok=0,
)
findings, result = run_audit("pipeworks", make_walker(), exp)
inv_errors = [v for v in result.violations if v.severity == "error"]
# len(inv_errors) == 150, all inside_solid_tile
```
