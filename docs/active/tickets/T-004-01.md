---
id: T-004-01
story: S-004
title: renderer
type: task
status: open
priority: high
phase: done
depends_on: [T-001-04]
---

## Context

Implement the code-generated geometric art renderer. All visuals drawn with Pyxel drawing primitives — no .pyxres sprite sheets.

Reference: docs/specification.md section 5

## Acceptance Criteria

- [ ] `renderer.py` implements drawing functions for all game entities:
- [ ] **Player character:**
  - Standing: body ellipse, limb lines, circle head, 2px dot eyes (~24px tall)
  - Running: 4-frame leg/arm animation cycling from frame_count
  - Rolling/spindash: circle with rotating line accent (~14px tall)
  - Jumping: rolling sprite
  - Facing direction: sprites flip horizontally based on movement direction
- [ ] **Terrain:** per-tile polygon from height profile to tile bottom, surface line along top edge. Color varies by stage theme (3 shades from palette slots 1–3).
- [ ] **Enemies:** geometric compositions — crab (ellipse + line claws), buzzer (circle + triangle wings), chopper (elongated ellipse), guardian (large shielded rect), egg piston (detailed boss sprite)
- [ ] **Objects:** rings (yellow circle + highlight), springs (red rect, 2 states), pipes (rect + arrow), checkpoint (post + rotating top), goal (tall post + spinning sign)
- [ ] **HUD:** ring count (flashes at 0), timer, lives — top-left via pyxel.text()
- [ ] **Palette:** 16-color allocation per spec. Palette swapped per stage for terrain colors (slots 1–3, 13–15).
- [ ] All drawing respects camera offset (pyxel.camera())
- [ ] Particle effects: ring scatter burst, enemy destroy sparkle
- [ ] Works with the player demo level from T-001-04
