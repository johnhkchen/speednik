---
id: T-002-05
story: S-002
title: pipeline-validation-and-testing
type: task
status: open
priority: medium
phase: done
depends_on: [T-002-01]
---

## Context

Add comprehensive tests and validation tooling to the SVG-to-stage pipeline to catch geometry errors before they reach the engine.

Reference: docs/specification.md section 4.4

## Acceptance Criteria

- [ ] Unit tests for rasterization:
  - Horizontal line → all tiles at same height, angle=0
  - 45° slope → linearly increasing height arrays, angle≈32 (45° in 0–255 space)
  - Circle → continuous angle values around perimeter, upper-half flagged for quadrant switching
- [ ] Unit tests for entity parsing:
  - Correctly extracts type from id attribute
  - Position from element center point
  - Handles all entity types in the spec
- [ ] Validation tests:
  - Angle discontinuity > 30° flagged correctly
  - Narrow gap < 18px flagged correctly
  - Steep slope sequence > 3 tiles flagged correctly
- [ ] Integration test: minimal SVG → full pipeline → output loads into engine without errors
- [ ] Validation report format is human-readable with line references back to SVG elements where possible
