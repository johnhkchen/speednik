---
id: T-011-01
story: S-011
title: stage-walkthrough-smoke-tests
type: task
status: open
priority: high
phase: done
depends_on: [T-010-02]
---

## Context

The most fundamental playability question: **can a robotic player reach the goal on each
stage?** This ticket runs 3 strategies across all 3 stages using `sim_step` and asserts
forward progress, goal reachability, and absence of soft-locks.

### Strategies

- `hold_right` — the beginner who only holds right. Tests basic terrain walkability.
- `hold_right_jump` — the spam-jumper. Tests gap clearing and platform reachability.
- `spindash_right` — the power player. Tests high-speed traversal, loop completion.

### Per-stage assertions

For each (stage, strategy) pair, run for enough frames (3000–6000 depending on stage length)
and assert:

1. **Forward progress**: `sim.max_x_reached` exceeds a stage-specific threshold (at minimum
   50% of level width). No soft-lock detected (`stuck_at` returns None).
2. **Goal reachable**: at least `spindash_right` reaches the goal on every stage.
   `hold_right` and `hold_right_jump` may not finish every stage — document which
   combinations succeed and which get stuck (and where).
3. **No unexpected deaths**: track `sim.deaths`. On hillside (the easiest stage), all 3
   strategies should complete with 0 deaths. On pipeworks and skybridge, deaths may be
   expected — assert they're below a reasonable cap.
4. **Ring collection**: `sim.rings_collected > 0` for all strategies that move forward.
5. **Frame budget**: no strategy should take more than 6000 frames to reach the goal.

### Stage data reference

| Stage     | Width  | Player start   | Goal ~X  |
|-----------|--------|----------------|----------|
| hillside  | 4800px | (64, 610)      | ~4700    |
| pipeworks | 5600px | (200, 510)     | ~5400    |
| skybridge | 5200px | (64, 490)      | ~5000    |

### Location

`tests/test_walkthrough.py` — new file.

## Acceptance Criteria

- [ ] 3 stages × 3 strategies = 9 test cases (parameterized)
- [ ] `spindash_right` reaches goal on all 3 stages
- [ ] No soft-lock detected on any passing test (stuck_at returns None)
- [ ] `rings_collected > 0` on all forward-moving strategies
- [ ] Deaths within expected bounds per stage
- [ ] Tests document which (stage, strategy) pairs reach goal vs. get stuck
- [ ] All tests use `sim_step` / `create_sim`, not the old harness
- [ ] `uv run pytest tests/test_walkthrough.py -x` passes
