---
id: T-001-04
story: S-001
title: player-module
type: task
status: open
priority: critical
phase: done
depends_on: [T-001-03]
---

## Context

Implement the player module that ties physics and collision together with input handling, state management, and animation state tracking.

Reference: docs/specification.md sections 2, 3.2, 5.1

## Acceptance Criteria

- [ ] `player.py` implements:
  - Player state machine: STANDING, RUNNING, ROLLING, JUMPING, SPINDASH, HURT, DEAD
  - Input handling: left/right movement, jump (with variable height), down to roll (when ground_speed >= 0.5), down+jump to spindash
  - Integration with physics.py: calls physics update functions in correct frame order
  - Integration with terrain.py: runs sensors, resolves collision, updates angle
  - Hitbox management: switches between standing (9×20) and rolling (7×14) radii on state change
  - Damage handling: ring scatter on hit (if rings > 0), death (if rings = 0), brief invulnerability after hit
  - Animation state tracking: current frame index, frame timer (does not draw — that's renderer's job)
- [ ] Player can run on flat ground, accelerate to top speed, decelerate, and stop via friction
- [ ] Player can jump with variable height, land on ground, and snap to tile angle
- [ ] Player can roll and spindash with correct charge/release mechanics
- [ ] Player traverses slopes with correct momentum gain/loss
- [ ] Demo mode: a test level with flat ground + a slope + a loop, player controllable with keyboard, visible as a colored rectangle (temporary rendering)
