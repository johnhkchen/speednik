---
id: T-001-02
story: S-001
title: physics-constants-and-core-engine
type: task
status: open
priority: critical
phase: done
depends_on: [T-001-01]
---

## Context

Implement the core physics engine with all Sonic 2 constants and the ground/air movement system. This does not include collision detection (that's T-001-03) — this ticket covers the mathematical model of movement.

Reference: docs/specification.md sections 2.1–2.4

## Acceptance Criteria

- [ ] `constants.py` populated with all physics constants from the spec (acceleration, deceleration, friction, top speed, gravity, jump force, slope factors, spindash values, sensor radii)
- [ ] `physics.py` implements:
  - Ground movement: acceleration, deceleration, friction, top speed enforcement (accel not applied above top_speed, momentum can exceed it)
  - Air movement: gravity, air acceleration, variable jump height (cap only when y_vel < 0 on release)
  - Slope factor application: `ground_speed -= slope_factor * sin(angle)` with correct factor selection (running vs rolling uphill vs rolling downhill)
  - Velocity decomposition: `x_vel = ground_speed * cos(angle)`, `y_vel = ground_speed * -sin(angle)`
  - Spindash: charge increment (+2 per press, max 8), decay (`spinrev -= spinrev / 32.0` per frame while holding), release (`ground_speed = 8 + floor(spinrev / 2)`)
  - Landing ground speed recalculation from x/y velocity based on impact angle ranges (flat/slope/steep)
  - Slipping: ignore input for 30 frames when |ground_speed| < 2.5 on slopes > 46°
- [ ] Frame update order matches spec exactly: input → slope factor → gravity → move → sensors → collision → angle
- [ ] Unit tests for: acceleration to top speed, spindash charge/decay/release, variable jump cap, slope factor on 45° slope, landing speed recalculation
- [ ] Rolling: no acceleration, rolling friction (half of standing), rolling decel, unroll below min_roll_speed
