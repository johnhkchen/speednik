---
id: T-009-03
story: S-009
title: dev-park-stages
type: task
status: open
priority: medium
phase: done
depends_on: [T-009-02]
---

## Context

Build the dev park stage menu and the individual elemental stages that render S-008 test
scenarios live on screen. Each stage shows one or two bots running a specific physics scenario
so the developer can watch the engine's behavior instead of just reading test output.

### Dev park menu

When the player selects "DEV PARK" from the stage select (T-009-01), they enter a sub-menu
listing the available dev park stages:

```
  DEV PARK
  --------
> RAMP WALKER
  SPEED GATE
  LOOP LAB
  GAP JUMP
  HILLSIDE BOT
```

UP/DOWN to select, Z to enter, X to go back to stage select. Same input pattern as the
existing stage select menu.

### Elemental stages

Each stage creates a synthetic grid (using T-008-02 builders), spawns one or two LiveBots
(from T-009-02), and runs them in real time with the camera following.

**RAMP WALKER** — Walkability threshold visualization

Uses `build_ramp()` with progressively steeper angles. A `hold_right` bot walks the ramp.
The camera follows the bot. A readout shows the current tile angle beneath the bot. The bot
will visibly stall when it hits the walkability threshold (~45°). Developer sees exactly
where walking fails.

Optional: two bots — `hold_right` (stalls) and `spindash_right` (clears the ramp).

**SPEED GATE** — Walk vs spindash comparison

Uses `build_ramp()` with a steep obstacle (60°+). Two bots side-by-side:
- `hold_right` (top) — blocked by the ramp
- `spindash_right` (bottom) — clears it

Both start at the same X. Camera shows both. Instant visual proof that speed gates work.

For side-by-side, either use a split view (two 128×224 panes) or stagger the bots vertically
on the same grid with enough Y separation that they don't overlap.

**LOOP LAB** — Loop traversal visualization

Uses `build_loop()` with and without ramps. Runs `spindash_right` through a loop with ramps
— the bot should complete the full circle. Then shows the same loop without ramps — the bot
gets stuck at the entry. This directly visualizes the S-007 fix.

**GAP JUMP** — Gap clearing demonstration

Uses `build_gap()` with different gap widths. A `hold_right_jump` bot attempts each gap. The
camera follows. Gaps get progressively wider until the bot fails to clear one.

**HILLSIDE BOT** — Real stage replay

Loads the actual hillside stage data and runs `hold_right` from the player start. The camera
follows the bot through the real level. Developer can watch where the bot gets stuck (the
loop, currently) — this is the visual equivalent of T-008-04's soft-lock detection.

### Stage lifecycle

Each dev park stage follows this loop:

1. **Init**: Create grid/load stage, spawn bot(s), set palette
2. **Update**: Call `bot.update()` for each bot. Check for completion or timeout.
3. **Draw**: Call `bot.draw()`. Render the debug HUD (from T-009-01). Render the bot label
   and scenario-specific readouts (angle, speed, position).
4. **Exit**: X key returns to dev park menu. Completed scenarios show a summary (e.g.,
   "STALLED AT X=1234, ANGLE=48").

### Palette

Dev park stages use a distinct palette — monochrome green-on-black terminal aesthetic to
reinforce the "debug mode" feel. Define `"devpark"` in the stage palette dict.

### Location

- `speednik/devpark.py` — extend with stage definitions, menu state, update/draw functions
- `speednik/renderer.py` — add `"devpark"` palette entry

## Acceptance Criteria

- [ ] Dev park sub-menu with 5 stage entries, UP/DOWN/Z/X navigation
- [ ] RAMP WALKER: shows hold_right bot walking until stall, angle readout visible
- [ ] SPEED GATE: shows walk vs spindash bot, visual comparison of blocked vs cleared
- [ ] LOOP LAB: shows loop with ramps (success) and without ramps (failure)
- [ ] GAP JUMP: shows gap clearing at progressive widths
- [ ] HILLSIDE BOT: runs hold_right on real hillside stage data
- [ ] Each stage has init/update/draw/exit lifecycle
- [ ] X key returns to dev park menu from any stage
- [ ] Dev park palette is distinct from gameplay palettes
- [ ] Bot labels rendered on screen
- [ ] Debug HUD visible during dev park stages
- [ ] `uv run pytest tests/ -x` passes
